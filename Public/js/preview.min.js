(function($){
	$.fn.CalImage=function(imgSrc,iwidth,iheight){		
	    var image=new Image();    
	    image.src=imgSrc;
	    if(image.complete){
	    	var oImage=new Image(); 
		    oImage.src=imgSrc; 
		    if(image.width>0 && image.height>0){    
		      if(image.width/image.height>= iwidth/iheight){    
		          if(image.width>iwidth){      
		        	  oImage.width=iwidth;    
		        	  oImage.height=(image.height*iwidth)/image.width;    
		          }else{    
		        	  oImage.width=image.width;      
		        	  oImage.height=image.height;    
		          }    
		      }else{    
		          if(image.height>iheight){      
		        	  oImage.height=iheight;    
		        	  oImage.width=(image.width*iheight)/image.height;            
		          }else{    
		        	  oImage.width=image.width;      
		        	  oImage.height=image.height;    
		          }    
		      }    
		    } 
		    
		    return oImage;
	    	
	    }else{
	    	image.onload=function(){
	    	
	    		var oImage=new Image(); 
			    oImage.src=imgSrc; 
			    if(image.width>0 && image.height>0){    
			      if(image.width/image.height>= iwidth/iheight){    
			          if(image.width>iwidth){      
			        	  oImage.width=iwidth;    
			        	  oImage.height=(image.height*iwidth)/image.width;    
			          }else{    
			        	  oImage.width=image.width;      
			        	  oImage.height=image.height;    
			          }    
			      }else{    
			          if(image.height>iheight){      
			        	  oImage.height=iheight;    
			        	  oImage.width=(image.width*iheight)/image.height;            
			          }else{    
			        	  oImage.width=image.width;      
			        	  oImage.height=image.height;    
			          }    
			      }    
			    } 
			    image.onload=null;
			    return oImage;
	    		
	    		
	    	};
	    	
	    }
	    
	    
	    
	    
	    
	    
	};
	
	
	
	
	$.fn.preview = function(width,height){

		var oWidth=width?width:300;
		var oHeight=height?height:400;
		$(this).each(function(){
			$(this).hover(function(e){
				var xOffset = 10;
				var yOffset = 20;
				var w = $(window).width();
				 console.log('开始执行图片浏览');  
				
				var  oTemp=$(this).attr('data')?$(this).attr('data'):$(this).attr('src');
				
				var  oImage=$(this).CalImage(oTemp,oWidth,oHeight);
				
				var oDiv=$('<div></div>');
				oDiv.attr('id','preview');
				var  oDivBox=$('<div></div>');
				var oImg=$('<img />');
				oImg.attr('src',oImage.src);
				oImg.css({
					height:oImage.height,
					width:oImage.width
				});
				oDivBox.append(oImg);
				oDiv.append(oDivBox);
				$("body").append(oDiv);
				$("#preview").css({
					position:"absolute",
					padding:"4px",
					border:"1px solid #f3f3f3",
					backgroundColor:"#eeeeee",
					top:(e.pageY - yOffset) + "px",
					zIndex:1000
				
				});
				$("#preview > div").css({
					padding:"5px",
					backgroundColor:"white",
					border:"1px solid #cccccc"
				
				});
				$("#preview > div > p").css({
					textAlign:"center",
					fontSize:"12px",
					padding:"8px 0 3px",
					margin:"0"
				
				});
				if(e.pageX < w/2){
					$("#preview").css({
						left: e.pageX + xOffset + "px",
						right: "auto"
					
					}).fadeIn("fast");
				}else{
					$("#preview").css("right",(w - e.pageX + yOffset) + "px").css("left", "auto").fadeIn("fast");
				}
			}
			,function(){
				$("#preview").remove();
			}).mousemove(function(e){
				var xOffset = 10;
				var yOffset = 20;
				var w = $(window).width();
				$("#preview").css("top",(e.pageY - xOffset) + "px");
				if(e.pageX < w/2){
					$("#preview").css("left",(e.pageX + yOffset) + "px").css("right","auto");
				}
				else{
					$("#preview").css("right",(w - e.pageX + yOffset) + "px").css("left","auto");
				}
			});
		});
	};
})(jQuery);
